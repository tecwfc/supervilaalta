<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no"
    />
    <title>Supervila ‚Äì Caixa</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <style>
      /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       BASE & VARS
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
      :root {
        --red: #e31d1a;
        --red-dark: #c41917;
        --yellow: #fff200;
        --green: #10b981;
        --rose: #ef4444;
        --slate-50: #f8fafc;
        --slate-100: #f1f5f9;
        --slate-200: #e2e8f0;
        --slate-400: #94a3b8;
        --slate-500: #64748b;
        --slate-600: #475569;
        --slate-700: #334155;
        --slate-800: #1e293b;
        --radius: 16px;
        --safe-bottom: env(safe-area-inset-bottom, 0px);
      }
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        -webkit-tap-highlight-color: transparent;
      }
      html,
      body {
        height: 100%;
        overflow: hidden;
      }
      body {
        font-family: "Plus Jakarta Sans", sans-serif;
        background: var(--slate-50);
        color: var(--slate-800);
        font-size: 14px;
        -webkit-font-smoothing: antialiased;
      }

      /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       LOGIN
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
      #telaLogin {
        position: fixed;
        inset: 0;
        z-index: 100;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(160deg, #1e293b 0%, #0f172a 100%);
        padding: 24px;
      }
      #telaLogin.hidden {
        display: none !important;
      }
      .login-card {
        background: #fff;
        border-radius: 28px;
        padding: 36px 28px 32px;
        width: 100%;
        max-width: 380px;
        box-shadow: 0 24px 60px rgba(0, 0, 0, 0.35);
      }
      .login-logo {
        text-align: center;
        margin-bottom: 28px;
      }
      .login-logo .badge {
        display: inline-flex;
        background: var(--red);
        padding: 8px 18px;
        border-radius: 12px;
        margin-bottom: 10px;
      }
      .login-logo .badge span {
        color: var(--yellow);
        font-weight: 900;
        font-size: 22px;
        letter-spacing: 2px;
      }
      .login-logo h2 {
        font-size: 15px;
        font-weight: 800;
        color: var(--slate-700);
        text-transform: uppercase;
        letter-spacing: 1px;
      }
      .login-logo p {
        font-size: 11px;
        color: var(--slate-400);
        margin-top: 4px;
      }

      .field {
        margin-bottom: 16px;
      }
      .field label {
        display: block;
        font-size: 10px;
        font-weight: 800;
        text-transform: uppercase;
        color: var(--slate-500);
        letter-spacing: 0.6px;
        margin-bottom: 6px;
      }
      .field input {
        width: 100%;
        padding: 14px 16px;
        border: 2px solid var(--slate-200);
        border-radius: 14px;
        font-family: inherit;
        font-size: 15px;
        font-weight: 600;
        background: var(--slate-50);
        outline: none;
        transition: border 0.2s;
      }
      .field input:focus {
        border-color: var(--red);
      }
      .pwd-wrap {
        position: relative;
      }
      .pwd-wrap input {
        padding-right: 48px;
      }
      .pwd-toggle {
        position: absolute;
        right: 14px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        cursor: pointer;
        font-size: 18px;
        color: var(--slate-400);
        transition: color 0.2s;
      }
      .pwd-toggle:hover {
        color: var(--red);
      }

      .msg-erro {
        background: #fef2f2;
        border-left: 4px solid var(--rose);
        padding: 10px 14px;
        border-radius: 10px;
        font-size: 12px;
        font-weight: 700;
        color: #b91c1c;
        margin-bottom: 14px;
        display: none;
      }
      .msg-erro.show {
        display: block;
        animation: shake 0.3s;
      }
      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-8px);
        }
        75% {
          transform: translateX(8px);
        }
      }

      .btn-login {
        width: 100%;
        height: 52px;
        background: var(--red);
        color: #fff;
        border: none;
        border-radius: 14px;
        font-family: inherit;
        font-size: 15px;
        font-weight: 800;
        text-transform: uppercase;
        letter-spacing: 1px;
        cursor: pointer;
        transition:
          background 0.2s,
          transform 0.1s;
      }
      .btn-login:active {
        background: var(--red-dark);
        transform: scale(0.97);
      }

      .spinner-wrap {
        display: none;
        text-align: center;
        padding: 24px 0;
      }
      .spinner-wrap.show {
        display: block;
      }
      .spinner {
        width: 44px;
        height: 44px;
        border: 4px solid var(--slate-200);
        border-top-color: var(--red);
        border-radius: 50%;
        animation: spin 0.6s linear infinite;
        margin: 0 auto 12px;
      }
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
      .spinner-wrap p {
        font-size: 13px;
        color: var(--slate-500);
        font-weight: 600;
      }

      /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       APP SHELL
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
      #app {
        display: none;
        height: 100%;
        flex-direction: column;
      }
      #app.show {
        display: flex;
      }

      /* Top bar (mobile) */
      .topbar {
        background: #fff;
        border-bottom: 1px solid var(--slate-200);
        padding: 12px 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-shrink: 0;
        position: sticky;
        top: 0;
        z-index: 10;
      }
      .topbar .logo-sm .badge-sm {
        display: inline-flex;
        background: var(--red);
        padding: 4px 10px;
        border-radius: 8px;
      }
      .topbar .logo-sm .badge-sm span {
        color: var(--yellow);
        font-weight: 900;
        font-size: 13px;
        letter-spacing: 1px;
      }
      .topbar .unidade-sm {
        font-size: 10px;
        font-weight: 700;
        color: var(--red);
        text-transform: uppercase;
        margin-top: 2px;
      }
      .topbar .btn-logout {
        background: none;
        border: none;
        font-size: 20px;
        cursor: pointer;
        padding: 6px;
        border-radius: 10px;
        transition: background 0.15s;
      }
      .topbar .btn-logout:active {
        background: #fee2e2;
      }

      /* Content scroll area */
      .content-scroll {
        flex: 1;
        overflow-y: auto;
        overflow-x: hidden;
        padding-bottom: calc(72px + var(--safe-bottom));
        -webkit-overflow-scrolling: touch;
      }
      .content-scroll > .page {
        display: none;
        padding: 16px;
      }
      .content-scroll > .page.active {
        display: block;
        animation: fadeUp 0.3s ease;
      }
      @keyframes fadeUp {
        from {
          opacity: 0;
          transform: translateY(12px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Bottom nav */
      .bottom-nav {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        height: calc(64px + var(--safe-bottom));
        background: #fff;
        border-top: 1px solid var(--slate-200);
        display: flex;
        align-items: flex-start;
        justify-content: space-around;
        padding-top: 8px;
        padding-bottom: var(--safe-bottom);
        z-index: 10;
      }
      .nav-btn {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 3px;
        background: none;
        border: none;
        cursor: pointer;
        font-family: inherit;
        font-size: 10px;
        font-weight: 700;
        color: var(--slate-400);
        transition: color 0.2s;
      }
      .nav-btn .nav-icon {
        font-size: 20px;
        transition: transform 0.2s;
      }
      .nav-btn.active {
        color: var(--red);
      }
      .nav-btn.active .nav-icon {
        transform: scale(1.15);
      }
      .nav-btn:active {
        opacity: 0.7;
      }

      /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       PAGE: DASHBOARD
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
      .greeting {
        padding: 4px 0 12px;
      }
      .greeting h1 {
        font-size: 20px;
        font-weight: 900;
      }
      .greeting p {
        font-size: 12px;
        color: var(--slate-500);
        margin-top: 2px;
      }
      .greeting .unit {
        color: var(--red);
        font-weight: 700;
      }

      .cards-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin-bottom: 18px;
      }
      .card-stat {
        background: #fff;
        border-radius: var(--radius);
        padding: 14px 16px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        border-left: 4px solid transparent;
      }
      .card-stat .lbl {
        font-size: 9px;
        font-weight: 800;
        text-transform: uppercase;
        color: var(--slate-400);
        letter-spacing: 0.4px;
        margin-bottom: 4px;
      }
      .card-stat .val {
        font-size: 18px;
        font-weight: 900;
      }
      .card-stat.green {
        border-left-color: var(--green);
      }
      .card-stat.green .val {
        color: var(--green);
      }
      .card-stat.rose {
        border-left-color: var(--rose);
      }
      .card-stat.rose .val {
        color: var(--rose);
      }
      .card-stat.orange {
        border-left-color: #f59e0b;
      }
      .card-stat.orange .val {
        color: #f59e0b;
      }
      .card-stat.slate {
        border-left-color: var(--slate-400);
      }
      .card-stat.slate .val {
        color: var(--slate-600);
      }
      .card-stat.highlight {
        grid-column: 1 / -1;
        background: var(--yellow);
        border-left-color: #ca8a04;
        text-align: center;
        padding: 16px;
      }
      .card-stat.highlight .val {
        font-size: 26px;
        color: var(--slate-800);
      }

      .chart-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin-top: 18px;
      }
      .chart-box {
        background: #fff;
        border-radius: var(--radius);
        padding: 14px 10px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
      }
      .chart-box h4 {
        font-size: 9px;
        font-weight: 800;
        text-transform: uppercase;
        color: var(--slate-400);
        text-align: center;
        letter-spacing: 0.3px;
        margin-bottom: 8px;
      }
      .chart-box canvas {
        max-height: 140px;
      }

      /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       PAGE: NOVO LAN√áAMENTO
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
      .page-header {
        font-size: 18px;
        font-weight: 900;
        margin-bottom: 18px;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .page-header .bar {
        width: 4px;
        height: 22px;
        background: var(--red);
        border-radius: 2px;
      }

      .form-card {
        background: #fff;
        border-radius: 20px;
        padding: 22px 18px;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.07);
      }
      .form-card .field input,
      .form-card .field select {
        font-size: 15px;
        padding: 13px 14px;
      }
      .form-card .row2 {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
      }
      .btn-primary {
        width: 100%;
        height: 52px;
        margin-top: 18px;
        background: var(--red);
        color: #fff;
        border: none;
        border-radius: 14px;
        font-family: inherit;
        font-size: 15px;
        font-weight: 800;
        text-transform: uppercase;
        letter-spacing: 0.8px;
        cursor: pointer;
        transition:
          background 0.2s,
          transform 0.1s;
        box-shadow: 0 4px 14px rgba(227, 29, 26, 0.35);
      }
      .btn-primary:active {
        background: var(--red-dark);
        transform: scale(0.97);
      }
      .btn-primary:disabled {
        background: var(--slate-400);
        box-shadow: none;
      }

      /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       PAGE: LIVRO DE CAIXA (mobile cards)
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
      .livro-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 14px;
      }
      .livro-header .page-header {
        margin-bottom: 0;
      }

      /* Saldo pr√©vio banner */
      .saldo-previo-banner {
        background: var(--slate-100);
        border-radius: 12px;
        padding: 10px 14px;
        margin-bottom: 14px;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }
      .saldo-previo-banner .lbl {
        font-size: 9px;
        font-weight: 800;
        text-transform: uppercase;
        color: var(--slate-500);
      }
      .saldo-previo-banner .val {
        font-size: 16px;
        font-weight: 900;
        color: var(--slate-700);
      }

      /* Filter bar */
      .filter-strip {
        background: #fff;
        border: 1px solid var(--slate-200);
        border-radius: 14px;
        padding: 14px;
        margin-bottom: 14px;
      }
      .filter-strip .filter-label {
        font-size: 9px;
        font-weight: 800;
        text-transform: uppercase;
        color: var(--slate-400);
        margin-bottom: 8px;
        letter-spacing: 0.4px;
      }
      .filter-strip .filter-row {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        align-items: flex-end;
      }
      .filter-strip select,
      .filter-strip input[type="date"] {
        border: 1.5px solid var(--slate-200);
        border-radius: 10px;
        padding: 8px 10px;
        font-family: inherit;
        font-size: 12px;
        font-weight: 600;
        background: var(--slate-50);
        outline: none;
        flex: 1;
        min-width: 90px;
      }
      .filter-strip select:focus,
      .filter-strip input[type="date"]:focus {
        border-color: var(--red);
      }
      .btn-pdf {
        background: var(--red);
        color: #fff;
        border: none;
        border-radius: 10px;
        padding: 8px 14px;
        font-family: inherit;
        font-size: 12px;
        font-weight: 800;
        cursor: pointer;
        white-space: nowrap;
        transition: background 0.2s;
      }
      .btn-pdf:active {
        background: var(--red-dark);
      }

      /* Entry cards */
      .entry-card {
        background: #fff;
        border-radius: 14px;
        padding: 12px 14px;
        margin-bottom: 8px;
        box-shadow: 0 1px 4px rgba(0, 0, 0, 0.06);
        border-left: 4px solid var(--slate-200);
        transition: transform 0.15s;
      }
      .entry-card:active {
        transform: scale(0.985);
      }
      .entry-card.entrada {
        border-left-color: var(--green);
      }
      .entry-card.saida {
        border-left-color: var(--rose);
      }

      .entry-card .top-row {
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        margin-bottom: 6px;
      }
      .entry-card .desc {
        font-size: 14px;
        font-weight: 700;
        color: var(--slate-700);
        flex: 1;
        padding-right: 10px;
        line-height: 1.3;
      }
      .entry-card .badge-tipo {
        font-size: 9px;
        font-weight: 800;
        text-transform: uppercase;
        padding: 3px 8px;
        border-radius: 6px;
        white-space: nowrap;
      }
      .badge-tipo.in {
        background: #d1fae5;
        color: #065f46;
      }
      .badge-tipo.out {
        background: #fee2e2;
        color: #991b1b;
      }

      .entry-card .bot-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }
      .entry-card .meta {
        font-size: 11px;
        color: var(--slate-400);
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .entry-card .valor-row {
        display: flex;
        align-items: center;
        gap: 12px;
      }
      .entry-card .valor {
        font-size: 15px;
        font-weight: 900;
      }
      .valor.in {
        color: var(--green);
      }
      .valor.out {
        color: var(--rose);
      }
      .entry-card .saldo-mini {
        font-size: 11px;
        font-weight: 700;
        color: var(--slate-500);
      }

      .entry-card .actions {
        display: flex;
        gap: 4px;
        margin-top: 10px;
        justify-content: flex-end;
      }
      .entry-card .actions button {
        background: var(--slate-100);
        border: none;
        border-radius: 8px;
        padding: 6px 12px;
        font-size: 13px;
        cursor: pointer;
        transition: background 0.15s;
      }
      .entry-card .actions button:active {
        background: var(--slate-200);
      }
      .entry-card .actions .btn-edit {
        color: #3b82f6;
      }
      .entry-card .actions .btn-del {
        color: var(--rose);
      }

      .empty-state {
        text-align: center;
        padding: 48px 20px;
        color: var(--slate-400);
        font-size: 13px;
        font-weight: 600;
      }
      .empty-state .icon {
        font-size: 40px;
        margin-bottom: 10px;
      }

      /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       PAGE: CONFIGURA√á√ïES
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
      .config-card {
        background: #fff;
        border-radius: 20px;
        padding: 24px 18px;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.07);
        max-width: 400px;
        margin: 0 auto;
      }
      .config-card .icon-wrap {
        width: 56px;
        height: 56px;
        background: #fef9c3;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 14px;
        font-size: 26px;
      }
      .config-card h3 {
        text-align: center;
        font-size: 17px;
        font-weight: 800;
        margin-bottom: 4px;
      }
      .config-card .sub {
        text-align: center;
        font-size: 11px;
        color: var(--slate-400);
        margin-bottom: 22px;
      }
      .config-card input[type="number"] {
        text-align: center;
        font-size: 24px;
        font-weight: 900;
        padding: 14px;
        border-radius: 14px;
      }
      .msg-sucesso {
        background: #ecfdf5;
        border-left: 4px solid var(--green);
        padding: 10px 14px;
        border-radius: 10px;
        font-size: 12px;
        font-weight: 700;
        color: #065f46;
        margin-bottom: 12px;
        display: none;
      }
      .msg-sucesso.show {
        display: block;
      }

      .info-box {
        background: var(--slate-50);
        border: 1px solid var(--slate-200);
        border-radius: 12px;
        padding: 12px 14px;
        margin-top: 18px;
      }
      .info-box .info-title {
        font-size: 9px;
        font-weight: 800;
        text-transform: uppercase;
        color: var(--slate-500);
        margin-bottom: 4px;
      }
      .info-box p {
        font-size: 11px;
        color: var(--slate-500);
        line-height: 1.5;
      }

      .btn-dark {
        width: 100%;
        height: 52px;
        margin-top: 18px;
        background: var(--slate-800);
        color: #fff;
        border: none;
        border-radius: 14px;
        font-family: inherit;
        font-size: 15px;
        font-weight: 800;
        text-transform: uppercase;
        letter-spacing: 0.8px;
        cursor: pointer;
        transition:
          background 0.2s,
          transform 0.1s;
      }
      .btn-dark:active {
        background: var(--slate-700);
        transform: scale(0.97);
      }
      .btn-dark:disabled {
        background: var(--slate-400);
      }

      /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       MODAL
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
      .modal-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.45);
        z-index: 200;
        display: none;
        align-items: flex-end;
        justify-content: center;
      }
      .modal-overlay.show {
        display: flex;
      }
      .modal-box {
        background: #fff;
        border-radius: 24px 24px 0 0;
        padding: 24px 18px 32px;
        width: 100%;
        max-width: 480px;
        animation: slideUp 0.25s ease;
        max-height: 85vh;
        overflow-y: auto;
      }
      @keyframes slideUp {
        from {
          transform: translateY(40px);
          opacity: 0.6;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }
      @media (min-width: 640px) {
        .modal-overlay {
          align-items: center;
        }
        .modal-box {
          border-radius: 24px;
          max-height: 90vh;
        }
      }
      .modal-top {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 20px;
      }
      .modal-top h3 {
        font-size: 17px;
        font-weight: 900;
      }
      .modal-close {
        background: none;
        border: none;
        font-size: 24px;
        color: var(--slate-400);
        cursor: pointer;
        line-height: 1;
      }
      .modal-close:active {
        color: var(--rose);
      }
      .modal-actions {
        display: flex;
        gap: 8px;
        margin-top: 18px;
      }
      .modal-actions .btn-primary {
        margin-top: 0;
        flex: 1;
        height: 48px;
        font-size: 13px;
      }
      .btn-cancel {
        height: 48px;
        padding: 0 18px;
        border: 2px solid var(--slate-200);
        background: none;
        border-radius: 12px;
        font-family: inherit;
        font-size: 13px;
        font-weight: 700;
        color: var(--slate-600);
        cursor: pointer;
      }
      .btn-cancel:active {
        background: var(--slate-100);
      }

      /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       DESKTOP OVERRIDE (sidebar layout)
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
      @media (min-width: 768px) {
        #app {
          flex-direction: row;
        }
        .topbar {
          display: none;
        }
        .bottom-nav {
          display: none;
        }
        .content-scroll {
          padding-bottom: 0;
        }

        .sidebar {
          display: flex;
          flex-direction: column;
          width: 240px;
          min-width: 240px;
          background: #fff;
          border-right: 1px solid var(--slate-200);
          padding: 24px 16px;
          height: 100vh;
          overflow-y: auto;
        }
        .sidebar .logo-area {
          text-align: center;
          margin-bottom: 28px;
        }
        .sidebar .logo-area .badge {
          display: inline-flex;
          background: var(--red);
          padding: 6px 14px;
          border-radius: 10px;
          margin-bottom: 6px;
        }
        .sidebar .logo-area .badge span {
          color: var(--yellow);
          font-weight: 900;
          font-size: 16px;
          letter-spacing: 2px;
        }
        .sidebar .logo-area .unit-badge {
          background: var(--slate-100);
          border-radius: 8px;
          padding: 6px 10px;
          margin-top: 8px;
        }
        .sidebar .logo-area .unit-badge .lbl2 {
          font-size: 8px;
          font-weight: 800;
          text-transform: uppercase;
          color: var(--slate-500);
        }
        .sidebar .logo-area .unit-badge .val2 {
          font-size: 11px;
          font-weight: 900;
          color: var(--red);
        }

        .sidebar nav {
          flex: 1;
        }
        .sidebar .nav-item {
          display: flex;
          align-items: center;
          gap: 10px;
          padding: 11px 14px;
          border-radius: 12px;
          margin-bottom: 4px;
          font-size: 13px;
          font-weight: 700;
          color: var(--slate-500);
          background: none;
          border: none;
          width: 100%;
          text-align: left;
          cursor: pointer;
          transition:
            background 0.15s,
            color 0.15s;
          font-family: inherit;
        }
        .sidebar .nav-item:hover {
          background: var(--slate-50);
        }
        .sidebar .nav-item.active {
          background: var(--red);
          color: #fff;
        }
        .sidebar .nav-item .nav-icon {
          font-size: 16px;
        }

        .sidebar .user-box {
          border-top: 1px solid var(--slate-200);
          padding-top: 16px;
          margin-top: 12px;
        }
        .sidebar .user-box .lbl {
          font-size: 9px;
          font-weight: 800;
          text-transform: uppercase;
          color: var(--slate-400);
        }
        .sidebar .user-box .name {
          font-size: 12px;
          font-weight: 800;
          color: var(--slate-700);
        }
        .sidebar .btn-logout-desk {
          width: 100%;
          margin-top: 10px;
          padding: 10px;
          background: none;
          border: 1.5px solid #fecaca;
          border-radius: 10px;
          color: var(--rose);
          font-family: inherit;
          font-size: 12px;
          font-weight: 700;
          cursor: pointer;
          transition: background 0.15s;
        }
        .sidebar .btn-logout-desk:hover {
          background: #fef2f2;
        }

        .content-scroll > .page {
          padding: 28px 32px;
          max-width: 900px;
        }
        .cards-grid {
          grid-template-columns: repeat(3, 1fr);
        }
        .card-stat.highlight {
          grid-column: auto;
        }
        .chart-row {
          grid-template-columns: 1fr 1fr;
        }
      }

      /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   FORM ACTIONS (Bot√µes elegantes)
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
      .form-actions {
        display: flex;
        gap: 12px;
        margin-top: 24px;
        align-items: center;
      }

      .btn-primary {
        flex: 2;
        height: 52px;
        background: var(--red);
        color: #fff;
        border: none;
        border-radius: 14px;
        font-family: inherit;
        font-size: 15px;
        font-weight: 800;
        text-transform: uppercase;
        letter-spacing: 0.8px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 4px 14px rgba(227, 29, 26, 0.35);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        position: relative;
        overflow: hidden;
      }

      .btn-primary:before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.2);
        transform: translate(-50%, -50%);
        transition:
          width 0.6s,
          height 0.6s;
      }

      .btn-primary:hover:before {
        width: 300px;
        height: 300px;
      }

      .btn-primary:hover {
        background: var(--red-dark);
        box-shadow: 0 6px 20px rgba(227, 29, 26, 0.45);
        transform: translateY(-2px);
      }

      .btn-primary:active {
        transform: translateY(0);
        box-shadow: 0 2px 8px rgba(227, 29, 26, 0.35);
      }

      .btn-primary:disabled {
        background: var(--slate-400);
        box-shadow: none;
        cursor: not-allowed;
        transform: none;
      }

      .btn-primary:disabled:hover:before {
        width: 0;
        height: 0;
      }

      .btn-clean {
        flex: 1;
        height: 52px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: #fff;
        border: none;
        border-radius: 14px;
        font-family: inherit;
        font-size: 15px;
        font-weight: 800;
        text-transform: uppercase;
        letter-spacing: 0.8px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 4px 14px rgba(102, 126, 234, 0.35);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        position: relative;
        overflow: hidden;
      }

      .btn-clean:before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.15);
        transform: translate(-50%, -50%);
        transition:
          width 0.6s,
          height 0.6s;
      }

      .btn-clean:hover:before {
        width: 300px;
        height: 300px;
      }

      .btn-clean:hover {
        background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.45);
        transform: translateY(-2px);
      }

      .btn-clean:active {
        transform: translateY(0);
        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.35);
      }

      .btn-icon {
        font-size: 18px;
        transition: transform 0.3s ease;
      }

      .btn-primary:hover .btn-icon {
        transform: scale(1.1) rotate(5deg);
      }

      .btn-clean:hover .btn-icon {
        transform: scale(1.1) rotate(-10deg);
        animation: sweep 0.5s ease;
      }

      @keyframes sweep {
        0% {
          transform: rotate(0deg);
        }
        25% {
          transform: rotate(-15deg);
        }
        75% {
          transform: rotate(5deg);
        }
        100% {
          transform: rotate(0deg);
        }
      }

      .btn-text {
        position: relative;
        z-index: 1;
      }

      /* Efeito de confirma√ß√£o quando limpa */
      .btn-clean.success {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        box-shadow: 0 4px 14px rgba(16, 185, 129, 0.35);
      }

      .btn-clean.success .btn-icon {
        animation: successSpin 0.6s ease;
      }

      @keyframes successSpin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Responsividade para telas menores */
      @media (max-width: 480px) {
        .form-actions {
          flex-direction: column;
          gap: 10px;
        }

        .btn-primary,
        .btn-clean {
          width: 100%;
          flex: none;
        }

        .btn-text {
          font-size: 14px;
        }
      }

      /* Estilo para os selects (consist√™ncia com outros campos) */
      .form-card .field select,
      .modal-box .field select {
        width: 100%;
        padding: 13px 14px;
        border: 2px solid var(--slate-200);
        border-radius: 14px;
        font-family: inherit;
        font-size: 15px;
        font-weight: 600;
        background: var(--slate-50);
        color: var(--slate-800);
        outline: none;
        cursor: pointer;
        transition: all 0.2s ease;
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%2364748b' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 14px center;
        background-size: 16px;
        padding-right: 40px;
      }

      .form-card .field select:focus,
      .modal-box .field select:focus {
        border-color: var(--red);
        box-shadow: 0 0 0 3px rgba(227, 29, 26, 0.1);
      }

      .form-card .field select:hover,
      .modal-box .field select:hover {
        border-color: var(--slate-300);
        background-color: var(--slate-100);
      }

      /* Estilo para options */
      .form-card .field select option,
      .modal-box .field select option {
        padding: 12px;
        background: white;
        color: var(--slate-800);
        font-size: 15px;
        font-weight: 600;
      }

      /* Destaque visual baseado no tipo selecionado */
      .form-card .field select[value="recebido"],
      .form-card .field select option[value="recebido"] {
        color: var(--green);
        font-weight: 700;
      }

      .form-card .field select[value="pago"],
      .form-card .field select option[value="pago"] {
        color: var(--rose);
        font-weight: 700;
      }

      /* Feedback visual ao selecionar */
      .form-card .field select:focus[value="recebido"] {
        border-color: var(--green);
        box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
      }

      .form-card .field select:focus[value="pago"] {
        border-color: var(--rose);
        box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
      }
    </style>
  </head>
  <body>
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     LOGIN SCREEN
     ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="telaLogin">
      <div class="login-card">
        <div class="login-logo">
          <div class="badge"><span>SUPERVILA</span></div>
          <h2>Controle de Caixa</h2>
          <p>Entre com suas credenciais</p>
        </div>
        <div id="loginForm">
          <div class="field">
            <label>Usu√°rio</label>
            <input
              type="text"
              id="inputUsuario"
              placeholder="Digite seu usu√°rio"
              autocomplete="off"
              onkeypress="
                if (event.key === 'Enter')
                  document.getElementById('inputSenha').focus();
              "
            />
          </div>
          <div class="field">
            <label>Senha</label>
            <div class="pwd-wrap">
              <input
                type="password"
                id="inputSenha"
                placeholder="Digite sua senha"
                autocomplete="off"
                onkeypress="if (event.key === 'Enter') verificarLogin();"
              />
              <button
                type="button"
                class="pwd-toggle"
                onclick="toggleSenha('inputSenha', this)"
              >
                üëÅÔ∏è
              </button>
            </div>
          </div>
          <div class="msg-erro" id="msgErro">
            ‚ùå Usu√°rio ou senha inv√°lidos!
          </div>
          <button class="btn-login" onclick="verificarLogin()">
            Entrar no Sistema
          </button>
        </div>
        <div class="spinner-wrap" id="carregando">
          <div class="spinner"></div>
          <p>Verificando credenciais‚Ä¶</p>
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     APP
     ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="app">
      <!-- Top bar (mobile only) -->
      <div class="topbar">
        <div class="logo-sm">
          <div class="badge-sm"><span>SUPERVILA</span></div>
          <div class="unidade-sm" id="topUnidade">‚Äî</div>
        </div>
        <button class="btn-logout" onclick="fazerLogout()">üö™</button>
      </div>

      <!-- Sidebar (desktop only) -->
      <aside class="sidebar" style="display: none">
        <div class="logo-area">
          <div class="badge"><span>SUPERVILA</span></div>
          <div class="unit-badge">
            <div class="lbl2">Unidade</div>
            <div class="val2" id="sideUnidade">‚Äî</div>
          </div>
        </div>
        <nav>
          <button class="nav-item active" onclick="mudarTab('dash', this)">
            <span class="nav-icon">üìä</span> Dashboard
          </button>
          <button class="nav-item" onclick="mudarTab('lancar', this)">
            <span class="nav-icon">‚ûï</span> Novo Lan√ßamento
          </button>
          <button class="nav-item" onclick="mudarTab('historico', this)">
            <span class="nav-icon">üìñ</span> Livro de Caixa
          </button>
          <button class="nav-item" onclick="mudarTab('config', this)">
            <span class="nav-icon">‚öôÔ∏è</span> Configura√ß√µes
          </button>
        </nav>
        <div class="user-box">
          <div class="lbl">Logado como</div>
          <div class="name" id="sideUsuario">‚Äî</div>
          <button class="btn-logout-desk" onclick="fazerLogout()">
            Sair do Sistema
          </button>
        </div>
      </aside>

      <!-- Scrollable content -->
      <div class="content-scroll">
        <!-- ‚îÄ‚îÄ DASHBOARD ‚îÄ‚îÄ -->
        <div class="page active" id="tab-dash">
          <div class="greeting">
            <h1>Ol√°, <span id="nomeOperador">Operador</span> üëã</h1>
            <p>Unidade: <span class="unit" id="txtUnidade">‚Äî</span></p>
          </div>
          <div class="cards-grid">
            <div class="card-stat green">
              <div class="lbl">Recebido</div>
              <div class="val" id="cardReceitas">R$ 0,00</div>
            </div>
            <div class="card-stat rose">
              <div class="lbl">Pago</div>
              <div class="val" id="cardPago">R$ 0,00</div>
            </div>
            <div class="card-stat orange">
              <div class="lbl">Fluxo</div>
              <div class="val" id="cardFluxo">R$ 0,00</div>
            </div>
            <div class="card-stat slate">
              <div class="lbl">Saldo Pr√©vio</div>
              <div class="val" id="cardPrevio">R$ 0,00</div>
            </div>
            <div class="card-stat highlight">
              <div class="lbl">Saldo em Caixa</div>
              <div class="val" id="cardSaldo">R$ 0,00</div>
            </div>
          </div>
          <div class="chart-row">
            <div class="chart-box">
              <h4>Propor√ß√£o</h4>
              <canvas id="graficoPizza"></canvas>
            </div>
            <div class="chart-box">
              <h4>Comparativo</h4>
              <canvas id="graficoBarras"></canvas>
            </div>
          </div>
        </div>

        <!-- ‚îÄ‚îÄ NOVO LAN√áAMENTO ‚îÄ‚îÄ -->
        <div class="page" id="tab-lancar">
          <div class="page-header"><span class="bar"></span> Novo Registro</div>
          <div class="form-card">
            <div class="field">
              <label>Data</label><input type="date" id="data" />
            </div>
            <div class="field">
              <label>Descri√ß√£o</label
              ><input
                type="text"
                id="desc"
                placeholder="Ex: Pagamento de fornecedor"
              />
            </div>
            <div class="row2">
              <div class="field">
                <label>Tipo</label>
                <select id="tipoOperacao">
                  <option value="recebido">Entrada (Recebido)</option>
                  <option value="pago">Sa√≠da (Pagamento)</option>
                </select>
              </div>
              <div class="field">
                <label>Valor (R$)</label>
                <input
                  type="number"
                  step="0.01"
                  id="valor"
                  placeholder="0,00"
                  inputmode="decimal"
                />
              </div>
            </div>

            <!-- BOT√ïES EM LINHA ELEGANTE -->
            <div class="form-actions">
              <button class="btn-primary" id="btnLancar" onclick="lancar()">
                <span class="btn-icon">üíæ</span>
                <span class="btn-text">Salvar no Livro</span>
              </button>
              <button class="btn-clean" onclick="limparCamposLancamento()">
                <span class="btn-icon">üßπ</span>
                <span class="btn-text">Limpar Campos</span>
              </button>
            </div>
          </div>
        </div>
        <!-- ‚îÄ‚îÄ LIVRO DE CAIXA ‚îÄ‚îÄ -->
        <div class="page" id="tab-historico">
          <div class="livro-header">
            <div class="page-header">
              <span class="bar"></span> Livro de Caixa
            </div>
          </div>
          <div class="saldo-previo-banner">
            <div><div class="lbl">Saldo Pr√©vio</div></div>
            <div class="val" id="bannerPrevio">R$ 0,00</div>
          </div>

          <!-- Filtro PDF -->
          <div class="filter-strip">
            <div class="filter-label">üìÑ Gerar PDF por per√≠odo</div>
            <div class="filter-row">
              <select id="filtroTipo" onchange="atualizarFiltroPeriodo()">
                <option value="mes">Por M√™s</option>
                <option value="periodo">Por Per√≠odo</option>
              </select>
              <div id="wrapMes" style="display: contents">
                <select id="filtroMes"></select>
                <select id="filtroMesAno"></select>
              </div>
              <div
                id="wrapPeriodo"
                style="display: none; display: none; contents: none"
              >
                <input type="date" id="filtroPeriodoInicio" />
                <input type="date" id="filtroPeriodoFim" />
              </div>
              <button class="btn-pdf" onclick="gerarPDFLivroCaixa()">
                üìÑ PDF
              </button>
            </div>
          </div>

          <!-- Cards list -->
          <div id="libroCards"></div>
        </div>

        <!-- ‚îÄ‚îÄ CONFIGURA√á√ïES ‚îÄ‚îÄ -->
        <div class="page" id="tab-config">
          <div class="config-card">
            <div class="icon-wrap">‚öôÔ∏è</div>
            <h3>Saldo Inicial</h3>
            <p class="sub">‚ö†Ô∏è Requer senha de autoriza√ß√£o</p>
            <div class="field">
              <label>Novo Saldo Inicial</label
              ><input
                type="number"
                step="0.01"
                id="inputSaldoPrevio"
                placeholder="0,00"
              />
            </div>
            <div class="field">
              <label>üîê Senha de Confirma√ß√£o</label>
              <div class="pwd-wrap">
                <input
                  type="password"
                  id="senhaConfirmacao"
                  placeholder="Senha de autoriza√ß√£o"
                  onkeypress="if (event.key === 'Enter') salvarConfiguracoes();"
                />
                <button
                  type="button"
                  class="pwd-toggle"
                  onclick="toggleSenha('senhaConfirmacao', this)"
                >
                  üëÅÔ∏è
                </button>
              </div>
            </div>
            <div class="msg-erro" id="msgErroConfig"></div>
            <div class="msg-sucesso" id="msgSucessoConfig">
              ‚úÖ Saldo atualizado com sucesso!
            </div>
            <button
              class="btn-dark"
              id="btnSalvarConfig"
              onclick="salvarConfiguracoes()"
            >
              Atualizar Saldo
            </button>
            <div class="info-box">
              <div class="info-title">‚ÑπÔ∏è Informa√ß√£o</div>
              <p>
                O saldo inicial representa o valor em caixa antes dos
                lan√ßamentos. Requer senha para seguran√ßa.
              </p>
            </div>
          </div>
        </div>
      </div>
      <!-- end content-scroll -->

      <!-- Bottom nav (mobile only) -->
      <nav class="bottom-nav">
        <button class="nav-btn active" onclick="mudarTab('dash', this)">
          <span class="nav-icon">üìä</span> Dashboard
        </button>
        <button class="nav-btn" onclick="mudarTab('lancar', this)">
          <span class="nav-icon">‚ûï</span> Novo
        </button>
        <button class="nav-btn" onclick="mudarTab('historico', this)">
          <span class="nav-icon">üìñ</span> Livro
        </button>
        <button class="nav-btn" onclick="mudarTab('config', this)">
          <span class="nav-icon">‚öôÔ∏è</span> Config
        </button>
      </nav>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     MODAL EDITAR
     ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div
      class="modal-overlay"
      id="modalEditar"
      onclick="if (event.target === this) fecharModal();"
    >
      <div class="modal-box">
        <div class="modal-top">
          <h3>‚úèÔ∏è Editar Registro</h3>
          <button class="modal-close" onclick="fecharModal()">√ó</button>
        </div>
        <input type="hidden" id="editId" />
        <div class="field">
          <label>Data</label><input type="date" id="editData" />
        </div>
        <div class="field">
          <label>Descri√ß√£o</label><input type="text" id="editDesc" />
        </div>
        <div
          class="row2"
          style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px"
        >
          <div class="field">
            <label>Tipo</label>
            <select id="editTipo">
              <option value="recebido">Entrada (Recebido)</option>
              <option value="pago">Sa√≠da (Pagamento)</option>
            </select>
          </div>
          <div class="field">
            <label>Valor (R$)</label>
            <input
              type="number"
              step="0.01"
              id="editValor"
              inputmode="decimal"
            />
          </div>
        </div>
        <div class="modal-actions">
          <button
            class="btn-primary"
            id="btnSalvarEditar"
            onclick="salvarEditar()"
          >
            Salvar
          </button>
          <button class="btn-cancel" onclick="fecharModal()">Cancelar</button>
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                                  SCRIPT
     ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <script>
      // ‚îÄ‚îÄ‚îÄ CONFIG ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      const API_URL =
        "https://script.google.com/macros/s/AKfycbzTwzOpHvOkXzOV23f7ZmJuJhgBeg3r6Wzy42azwCWzV4yM5I3Jb5NlRV22YWfdGwzG/exec";

      // ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è SUAS CREDENCIAIS ESPEC√çFICAS ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è
      const CREDENCIAIS_FIXAS = {
        // Usu√°rio (Coluna A): { senha: "Coluna B", nome: "Coluna C" }
        supervilaalta: { senha: "S0l@2003", nome: "caixa supervila alta" },
        supervilamuriti: { senha: "Ers626637", nome: "caixa supervila muriti" },
        admin: { senha: "admin10", nome: "admin" },
      };

      let usuarioLogado = null;
      let chartPizza = null,
        chartBarras = null;
      let dadosCache = { lista: [], saldoPrevio: 0 };

      // ‚îÄ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      window.addEventListener("DOMContentLoaded", () => {
        document.getElementById("data").value = new Date()
          .toISOString()
          .split("T")[0];
        popularFiltroMesAno();
        verificarSessaoSalva();
        if (window.innerWidth >= 768)
          document.querySelector(".sidebar").style.display = "flex";
      });
      window.addEventListener("resize", () => {
        document.querySelector(".sidebar").style.display =
          window.innerWidth >= 768 ? "flex" : "none";
      });

      // ‚îÄ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function toggleSenha(id, btn) {
        const inp = document.getElementById(id);
        inp.type = inp.type === "password" ? "text" : "password";
        btn.textContent = inp.type === "text" ? "üôà" : "üëÅÔ∏è";
      }

      function fmt(v) {
        const num = parseFloat(v) || 0;
        return num.toLocaleString("pt-BR", {
          style: "currency",
          currency: "BRL",
        });
      }

      function parseDate(raw) {
        if (!raw) return null;
        try {
          if (String(raw).includes("T")) return new Date(raw);
          if (String(raw).includes("/")) {
            const p = String(raw).split("/");
            return p[0].length === 4
              ? new Date(+p[0], +p[1] - 1, +p[2])
              : new Date(+p[2], +p[1] - 1, +p[0]);
          }
          if (String(raw).includes("-")) {
            const p = String(raw).split("-");
            return new Date(+p[0], +p[1] - 1, +p[2]);
          }
        } catch (e) {}
        return null;
      }

      function fmtDateBR(raw) {
        const d = parseDate(raw);
        if (!d || isNaN(d)) return String(raw);
        return d.toLocaleDateString("pt-BR");
      }

      // ‚îÄ‚îÄ‚îÄ SESS√ÉO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function verificarSessaoSalva() {
        // Usamos localStorage APENAS para manter a sess√£o ativa entre recarregamentos
        const s = localStorage.getItem("supervilaSessao");
        if (!s) return;
        try {
          const d = JSON.parse(s);
          if (d.usuario && d.senha && d.nome) {
            usuarioLogado = d;
            entrarNoApp();
          } else localStorage.removeItem("supervilaSessao");
        } catch (e) {
          localStorage.removeItem("supervilaSessao");
        }
      }

      function entrarNoApp() {
        document.getElementById("telaLogin").classList.add("hidden");
        document.getElementById("app").classList.add("show");
        document.getElementById("txtUnidade").innerText = usuarioLogado.nome;
        document.getElementById("topUnidade").innerText = usuarioLogado.nome;
        document.getElementById("sideUnidade").innerText = usuarioLogado.nome;
        document.getElementById("sideUsuario").innerText =
          usuarioLogado.usuario;
        document.getElementById("nomeOperador").innerText =
          usuarioLogado.nome.split(" ")[0];

        atualizarTabela();
      }

      // ‚îÄ‚îÄ‚îÄ LOGIN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      async function verificarLogin() {
        const usuario = document
          .getElementById("inputUsuario")
          .value.toLowerCase()
          .trim();
        const senha = document.getElementById("inputSenha").value;
        const msgErro = document.getElementById("msgErro");
        const form = document.getElementById("loginForm");

        // Limpar erro anterior
        msgErro.classList.remove("show");

        if (!usuario || !senha) {
          msgErro.innerText = "‚ùå Preencha usu√°rio e senha!";
          msgErro.classList.add("show");
          return;
        }

        // Mostrar loading
        form.style.pointerEvents = "none";
        form.classList.add("hidden");
        document.getElementById("carregando").classList.add("show");

        try {
          // Tenta primeiro a API
          const res = await fetch(
            `${API_URL}?action=login&usuario=${encodeURIComponent(usuario)}&senha=${encodeURIComponent(senha)}`,
          );
          const data = await res.json();

          if (data && data.sucesso) {
            // Login via API bem sucedido
            usuarioLogado = {
              usuario: data.usuario || usuario,
              senha: senha,
              nome: data.empresa || usuario,
            };

            // Salva no localStorage APENAS para manter sess√£o
            localStorage.setItem(
              "supervilaSessao",
              JSON.stringify(usuarioLogado),
            );

            entrarNoApp();
          } else {
            // Se API falhar, tenta credenciais fixas
            if (
              CREDENCIAIS_FIXAS[usuario] &&
              CREDENCIAIS_FIXAS[usuario].senha === senha
            ) {
              usuarioLogado = {
                usuario: usuario,
                senha: senha,
                nome: CREDENCIAIS_FIXAS[usuario].nome,
              };

              // Salva no localStorage APENAS para manter sess√£o
              localStorage.setItem(
                "supervilaSessao",
                JSON.stringify(usuarioLogado),
              );

              entrarNoApp();
            } else {
              // Login falhou
              document.getElementById("carregando").classList.remove("show");
              form.classList.remove("hidden");
              form.style.pointerEvents = "";

              msgErro.innerText = "‚ùå Usu√°rio ou senha inv√°lidos!";
              msgErro.classList.add("show");

              // Limpar campo de senha
              document.getElementById("inputSenha").value = "";
              document.getElementById("inputSenha").focus();
            }
          }
        } catch (e) {
          // Erro de rede - tenta credenciais fixas
          console.error("Erro na API, tentando credenciais locais:", e);

          if (
            CREDENCIAIS_FIXAS[usuario] &&
            CREDENCIAIS_FIXAS[usuario].senha === senha
          ) {
            usuarioLogado = {
              usuario: usuario,
              senha: senha,
              nome: CREDENCIAIS_FIXAS[usuario].nome,
            };

            // Salva no localStorage APENAS para manter sess√£o
            localStorage.setItem(
              "supervilaSessao",
              JSON.stringify(usuarioLogado),
            );

            entrarNoApp();
          } else {
            // Login falhou
            document.getElementById("carregando").classList.remove("show");
            form.classList.remove("hidden");
            form.style.pointerEvents = "";

            msgErro.innerText = "‚ùå Erro de conex√£o. Tente novamente.";
            msgErro.classList.add("show");
          }
        }
      }

      // ‚îÄ‚îÄ‚îÄ TABS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function mudarTab(id, el) {
        document
          .querySelectorAll(".page")
          .forEach((p) => p.classList.remove("active"));
        document.getElementById("tab-" + id).classList.add("active");

        // Mobile nav
        document
          .querySelectorAll(".bottom-nav .nav-btn")
          .forEach((b) => b.classList.remove("active"));
        // Desktop sidebar
        document
          .querySelectorAll(".sidebar .nav-item")
          .forEach((b) => b.classList.remove("active"));

        // Highlight correct buttons
        const idx = ["dash", "lancar", "historico", "config"].indexOf(id);
        const mobileBtn = document.querySelectorAll(".bottom-nav .nav-btn")[
          idx
        ];
        const desktopBtn = document.querySelectorAll(".sidebar .nav-item")[idx];
        if (mobileBtn) mobileBtn.classList.add("active");
        if (desktopBtn) desktopBtn.classList.add("active");

        // Scroll to top
        document.querySelector(".content-scroll").scrollTop = 0;
      }

      function fazerLogout() {
        if (confirm("Deseja realmente sair?")) {
          // Remove do localStorage mas mant√©m na planilha
          localStorage.removeItem("supervilaSessao");
          usuarioLogado = null;
          location.reload();
        }
      }

      // ‚îÄ‚îÄ‚îÄ FETCH + RENDER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      async function atualizarTabela() {
        if (!usuarioLogado) return;
        try {
          const res = await fetch(
            `${API_URL}?senha=${usuarioLogado.senha}&usuario=${usuarioLogado.usuario}&action=ler`,
          );
          const data = await res.json();

          console.log("Dados recebidos da API:", data);

          if (data && data.lista !== undefined) {
            dadosCache.lista = data.lista || [];
            dadosCache.saldoPrevio = parseFloat(data.saldoPrevio) || 0;

            // Converter valores com v√≠rgula para n√∫mero
            let tRec = 0,
              tPag = 0;
            dadosCache.lista.forEach((i) => {
              const recebido = parseFloat(String(i[3]).replace(",", ".")) || 0;
              const pago = parseFloat(String(i[4]).replace(",", ".")) || 0;
              tRec += recebido;
              tPag += pago;
            });
            const mov = tRec - tPag;

            document.getElementById("cardReceitas").innerText = fmt(tRec);
            document.getElementById("cardPago").innerText = fmt(tPag);
            document.getElementById("cardFluxo").innerText = fmt(mov);
            document.getElementById("cardPrevio").innerText = fmt(
              dadosCache.saldoPrevio,
            );
            document.getElementById("cardSaldo").innerText = fmt(
              dadosCache.saldoPrevio + mov,
            );
            document.getElementById("bannerPrevio").innerText = fmt(
              dadosCache.saldoPrevio,
            );
            document.getElementById("inputSaldoPrevio").value =
              dadosCache.saldoPrevio;

            renderCards(dadosCache.lista, dadosCache.saldoPrevio);
            renderGraficos(tRec, tPag);
          } else {
            console.error("Formato de dados inv√°lido da API");
          }
        } catch (e) {
          console.error("Erro ao carregar dados:", e);
          alert("‚ùå Erro ao carregar dados da planilha");
        }
      }

      // ‚îÄ‚îÄ‚îÄ LIVRO DE CAIXA: CARDS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function renderCards(lista, saldoPrevio) {
        const container = document.getElementById("libroCards");
        if (lista.length === 0) {
          container.innerHTML =
            '<div class="empty-state"><div class="icon">üì≠</div>Nenhum registro ainda.<br><small>Fa√ßa seu primeiro lan√ßamento!</small></div>';
          return;
        }
        let acum = saldoPrevio,
          html = "";

        // Ordenar por data (mais recente primeiro)
        const listaOrdenada = [...lista].sort((a, b) => {
          const dateA = parseDate(a[1]) || new Date(0);
          const dateB = parseDate(b[1]) || new Date(0);
          return dateB - dateA; // Mais recente primeiro
        });

        listaOrdenada.forEach((item) => {
          const recebido = parseFloat(String(item[3]).replace(",", ".")) || 0;
          const pago = parseFloat(String(item[4]).replace(",", ".")) || 0;
          const isEntrada = recebido > 0;
          const valorExib = isEntrada ? recebido : pago;
          acum += recebido - pago;
          const descEsc = item[2]
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/'/g, "\\'");

          html += `<div class="entry-card ${isEntrada ? "entrada" : "saida"}">
  <div class="top-row">
    <div class="desc">${item[2]}</div>
    <span class="badge-tipo ${isEntrada ? "in" : "out"}">
      ${isEntrada ? "Entrada" : "Sa√≠da"}
    </span>
  </div>
      <div class="bot-row">
        <div class="meta">
          <span>üìÖ ${fmtDateBR(item[1])}</span>
          <span style="color:var(--slate-300)">|</span>
          <span>Saldo: <strong>${fmt(acum)}</strong></span>
        </div>
        <div class="valor ${isEntrada ? "in" : "out"}">${isEntrada ? "+" : "-"} ${fmt(valorExib)}</div>
      </div>
      <div class="actions">
        <button class="btn-edit" onclick="abrirModal('${item[0]}','${item[1]}','${descEsc}',${recebido},${pago})">‚úèÔ∏è Editar</button>
        <button class="btn-del" onclick="excluir('${item[0]}')">üóëÔ∏è</button>
      </div>
    </div>`;
        });
        container.innerHTML = html;
      }

      // ‚îÄ‚îÄ‚îÄ GRAFICOS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function renderGraficos(rec, pag) {
        const ctxP = document.getElementById("graficoPizza").getContext("2d");
        const ctxB = document.getElementById("graficoBarras").getContext("2d");
        if (chartPizza) chartPizza.destroy();
        if (chartBarras) chartBarras.destroy();
        chartPizza = new Chart(ctxP, {
          type: "doughnut",
          data: {
            labels: ["Entradas", "Sa√≠das"],
            datasets: [
              {
                data: [rec, pag],
                backgroundColor: ["#10b981", "#ef4444"],
                borderWidth: 2,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: "bottom",
                labels: { font: { size: 11 }, boxWidth: 14 },
              },
            },
          },
        });
        chartBarras = new Chart(ctxB, {
          type: "bar",
          data: {
            labels: ["Entradas", "Sa√≠das"],
            datasets: [
              {
                data: [rec, pag],
                backgroundColor: ["#10b981", "#ef4444"],
                borderRadius: 6,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
              y: { ticks: { font: { size: 10 } } },
              x: { ticks: { font: { size: 11 } } },
            },
          },
        });
      }

      // ‚îÄ‚îÄ‚îÄ LAN√áAMENTO (COM FEEDBACK VISUAL) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      async function lancar() {
        if (!usuarioLogado) return;
        const btn = document.getElementById("btnLancar");
        const tipo = document.getElementById("tipoOperacao").value;
        let valor = document.getElementById("valor").value;
        const dataInput = document.getElementById("data").value;
        const desc = document.getElementById("desc").value;

        // Valida√ß√£o com efeito visual
        if (!desc || !valor || !dataInput) {
          // Efeito de shake nos campos vazios
          const campos = [];
          if (!desc) campos.push("desc");
          if (!valor) campos.push("valor");
          if (!dataInput) campos.push("data");

          campos.forEach((id) => {
            const campo = document.getElementById(id);
            campo.style.animation = "shake 0.5s ease";
            campo.style.borderColor = "var(--rose)";
            setTimeout(() => {
              campo.style.animation = "";
              campo.style.borderColor = "";
            }, 500);
          });

          return;
        }

        // Formata valor para n√∫mero
        valor = valor.replace(",", ".");
        const valorNum = parseFloat(valor) || 0;

        if (valorNum <= 0) {
          document.getElementById("valor").style.borderColor = "var(--rose)";
          document.getElementById("valor").style.animation = "shake 0.5s ease";
          setTimeout(() => {
            document.getElementById("valor").style.borderColor = "";
            document.getElementById("valor").style.animation = "";
          }, 500);
          return;
        }

        const p = dataInput.split("-");
        const dataFmt = `${p[2]}/${p[1]}/${p[0]}`;

        // Salva estado original do bot√£o
        const originalHTML = btn.innerHTML;
        btn.innerHTML =
          '<span class="btn-icon">‚è≥</span><span class="btn-text">Salvando...</span>';
        btn.disabled = true;

        // Efeito de loading
        btn.style.opacity = "0.8";
        btn.style.cursor = "wait";

        try {
          const response = await fetch(API_URL, {
            method: "POST",
            body: JSON.stringify({
              action: "lancar",
              usuario: usuarioLogado.usuario,
              desc: desc,
              data: dataFmt,
              recebido: tipo === "recebido" ? valorNum : 0,
              pago: tipo === "pago" ? valorNum : 0,
            }),
          });

          const data = await response.json();

          if (data && data.status === "sucesso") {
            // ‚úÖ SUCESSO - Anima√ß√£o de confirma√ß√£o
            btn.innerHTML =
              '<span class="btn-icon">‚úÖ</span><span class="btn-text">Salvo!</span>';
            btn.style.background =
              "linear-gradient(135deg, #10b981 0%, #059669 100%)";
            btn.style.boxShadow = "0 4px 14px rgba(16, 185, 129, 0.35)";

            // Limpa campos com anima√ß√£o
            setTimeout(() => {
              // Anima√ß√£o de fade out dos campos
              ["desc", "valor"].forEach((id, index) => {
                const campo = document.getElementById(id);
                campo.style.transition = "all 0.3s ease";
                campo.style.opacity = "0.3";
                campo.style.transform = "translateY(-5px)";

                setTimeout(
                  () => {
                    campo.value = "";
                    campo.style.opacity = "1";
                    campo.style.transform = "translateY(0)";
                  },
                  200 * (index + 1),
                );
              });

              // Mant√©m data atual
              document.getElementById("data").value = new Date()
                .toISOString()
                .split("T")[0];

              // Foco no campo descri√ß√£o
              document.getElementById("desc").focus();

              // Restaura bot√£o ap√≥s 1 segundo
              setTimeout(() => {
                btn.innerHTML = originalHTML;
                btn.style.background = "";
                btn.style.boxShadow = "0 4px 14px rgba(227, 29, 26, 0.35)";
                btn.disabled = false;
                btn.style.opacity = "1";
                btn.style.cursor = "pointer";
              }, 1000);
            }, 500);

            // Atualiza tabela em segundo plano
            atualizarTabela();
          } else {
            // ‚ùå ERRO
            btn.innerHTML =
              '<span class="btn-icon">‚ùå</span><span class="btn-text">Erro!</span>';
            btn.style.background =
              "linear-gradient(135deg, #ef4444 0%, #dc2626 100%)";

            setTimeout(() => {
              btn.innerHTML = originalHTML;
              btn.style.background = "";
              btn.disabled = false;
              btn.style.opacity = "1";
              btn.style.cursor = "pointer";
              alert(
                "‚ùå Erro ao salvar: " + (data?.erro || "Verifique a conex√£o"),
              );
            }, 1500);
          }
        } catch (e) {
          console.error("Erro:", e);

          btn.innerHTML =
            '<span class="btn-icon">‚ö†Ô∏è</span><span class="btn-text">Falha!</span>';
          btn.style.background =
            "linear-gradient(135deg, #f59e0b 0%, #d97706 100%)";

          setTimeout(() => {
            btn.innerHTML = originalHTML;
            btn.style.background = "";
            btn.disabled = false;
            btn.style.opacity = "1";
            btn.style.cursor = "pointer";
            alert("‚ùå Erro de conex√£o com a planilha!");
          }, 1500);
        }
      }
      // ‚îÄ‚îÄ‚îÄ EXCLUIR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      async function excluir(id) {
        if (
          !usuarioLogado ||
          !confirm("Excluir este registro permanentemente da planilha?")
        )
          return;
        try {
          const response = await fetch(
            `${API_URL}?senha=${usuarioLogado.senha}&usuario=${usuarioLogado.usuario}&action=excluir&id=${id}`,
          );
          const data = await response.json();

          if (data && data.status === "ok") {
            alert("‚úÖ Registro exclu√≠do com sucesso!");
            atualizarTabela();
          } else {
            alert("‚ùå Erro: " + (data?.erro || "N√£o foi poss√≠vel excluir"));
          }
        } catch (e) {
          console.error("Erro:", e);
          alert("‚ùå Erro de conex√£o com a planilha!");
        }
      }

      // ‚îÄ‚îÄ‚îÄ MODAL EDITAR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function abrirModal(id, data, desc, rec, pag) {
        let dataInput = data;
        try {
          const d = parseDate(data);
          if (d) {
            const y = d.getFullYear(),
              m = String(d.getMonth() + 1).padStart(2, "0"),
              dd = String(d.getDate()).padStart(2, "0");
            dataInput = `${y}-${m}-${dd}`;
          }
        } catch (e) {}
        document.getElementById("editId").value = id;
        document.getElementById("editData").value = dataInput;
        document.getElementById("editDesc").value = desc;

        // Define o tipo baseado nos valores recebidos
        const isEntrada = rec > 0;
        document.getElementById("editTipo").value = isEntrada
          ? "recebido"
          : "pago";
        document.getElementById("editValor").value = isEntrada ? rec : pag;

        // Aplica estilo visual baseado no tipo
        const select = document.getElementById("editTipo");
        if (isEntrada) {
          select.style.borderColor = "var(--green)";
          select.style.color = "var(--green)";
        } else {
          select.style.borderColor = "var(--rose)";
          select.style.color = "var(--rose)";
        }

        document.getElementById("modalEditar").classList.add("show");
      }

      // Adiciona evento para mudar cor do select baseado na sele√ß√£o
      document.addEventListener("DOMContentLoaded", function () {
        const selects = ["tipoOperacao", "editTipo"];

        selects.forEach((selectId) => {
          const select = document.getElementById(selectId);
          if (select) {
            // Aplica cor inicial
            updateSelectColor(select);

            // Adiciona listener para mudan√ßas
            select.addEventListener("change", function () {
              updateSelectColor(this);
            });
          }
        });

        function updateSelectColor(selectElement) {
          if (selectElement.value === "recebido") {
            selectElement.style.borderColor = "var(--green)";
            selectElement.style.color = "var(--green)";
            selectElement.style.fontWeight = "700";
          } else if (selectElement.value === "pago") {
            selectElement.style.borderColor = "var(--rose)";
            selectElement.style.color = "var(--rose)";
            selectElement.style.fontWeight = "700";
          }
        }
      });

      function fecharModal() {
        // Reseta estilos do select
        const select = document.getElementById("editTipo");
        if (select) {
          select.style.borderColor = "";
          select.style.color = "";
          select.style.fontWeight = "";
        }

        document.getElementById("modalEditar").classList.remove("show");
      }

      async function salvarEditar() {
        const btn = document.getElementById("btnSalvarEditar");
        const id = document.getElementById("editId").value;
        const dataInput = document.getElementById("editData").value;
        const desc = document.getElementById("editDesc").value;
        const tipo = document.getElementById("editTipo").value;
        let valor = document.getElementById("editValor").value;

        if (!dataInput || !desc || !valor) {
          alert("‚ùå Preencha todos os campos!");
          return;
        }

        // Formata valor para n√∫mero
        valor = valor.replace(",", ".");
        const valorNum = parseFloat(valor) || 0;

        if (valorNum <= 0) {
          alert("‚ùå Digite um valor v√°lido maior que zero!");
          return;
        }

        const p = dataInput.split("-");
        const dataFmt = `${p[2]}/${p[1]}/${p[0]}`;

        btn.innerText = "Salvando‚Ä¶";
        btn.disabled = true;
        try {
          const response = await fetch(API_URL, {
            method: "POST",
            body: JSON.stringify({
              action: "editar",
              usuario: usuarioLogado.usuario,
              id: id,
              data: dataFmt,
              desc: desc,
              recebido: tipo === "recebido" ? valorNum : 0,
              pago: tipo === "pago" ? valorNum : 0,
            }),
          });

          const data = await response.json();

          if (data && data.status === "ok") {
            alert("‚úÖ Registro editado com sucesso!");
            fecharModal();
            atualizarTabela();
          } else {
            alert("‚ùå Erro: " + (data?.erro || "N√£o foi poss√≠vel editar"));
          }
        } catch (e) {
          console.error("Erro:", e);
          alert("‚ùå Erro de conex√£o com a planilha!");
        } finally {
          btn.innerText = "Salvar";
          btn.disabled = false;
        }
      }

      // ‚îÄ‚îÄ‚îÄ LIMPAR CAMPOS DO LAN√áAMENTO (ELEGANTE) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function limparCamposLancamento() {
        // Anima√ß√£o suave dos campos
        const campos = ["desc", "valor"];
        campos.forEach((id, index) => {
          const campo = document.getElementById(id);
          campo.style.transition = "all 0.3s ease";
          campo.style.opacity = "0.5";
          campo.style.transform = "translateX(-10px)";

          setTimeout(
            () => {
              campo.value = "";
              campo.style.opacity = "1";
              campo.style.transform = "translateX(0)";
            },
            150 * (index + 1),
          );
        });

        // Mant√©m a data atual (com anima√ß√£o)
        const dataField = document.getElementById("data");
        dataField.style.transition = "all 0.3s ease";
        dataField.style.opacity = "0.7";
        setTimeout(() => {
          dataField.value = new Date().toISOString().split("T")[0];
          dataField.style.opacity = "1";
        }, 300);

        // Feedback visual no bot√£o
        const btn = document.querySelector(".btn-clean");
        const originalHTML = btn.innerHTML;

        // Efeito de sucesso
        btn.classList.add("success");
        btn.innerHTML =
          '<span class="btn-icon">‚úÖ</span><span class="btn-text">Limpo!</span>';

        // Foco no campo descri√ß√£o
        setTimeout(() => {
          document.getElementById("desc").focus();
        }, 400);

        // Restaura bot√£o ap√≥s 1.5 segundos
        setTimeout(() => {
          btn.classList.remove("success");
          btn.innerHTML = originalHTML;
        }, 1500);

        // Feedback sonoro opcional (remove o coment√°rio se quiser)
        try {
          new Audio(
            "data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEAQB8AAEAfAAABAAgAZGF0YQ",
          ).play();
        } catch (e) {}
      }

      function configurarAtalhosLancamento() {
        // Enter no campo valor executa o lan√ßamento
        document
          .getElementById("valor")
          .addEventListener("keypress", function (e) {
            if (e.key === "Enter") {
              lancar();
            }
          });

        // Enter no campo descri√ß√£o vai para valor
        document
          .getElementById("desc")
          .addEventListener("keypress", function (e) {
            if (e.key === "Enter") {
              e.preventDefault();
              document.getElementById("valor").focus();
            }
          });
      }

      // Chame esta fun√ß√£o ap√≥s entrar no app:
      function entrarNoApp() {
        document.getElementById("telaLogin").classList.add("hidden");
        document.getElementById("app").classList.add("show");
        document.getElementById("txtUnidade").innerText = usuarioLogado.nome;
        document.getElementById("topUnidade").innerText = usuarioLogado.nome;
        document.getElementById("sideUnidade").innerText = usuarioLogado.nome;
        document.getElementById("sideUsuario").innerText =
          usuarioLogado.usuario;
        document.getElementById("nomeOperador").innerText =
          usuarioLogado.nome.split(" ")[0];

        // Configura atalhos
        configurarAtalhosLancamento();

        // Foco no campo descri√ß√£o quando mudar para aba de lan√ßamento
        document.querySelectorAll(".nav-btn, .nav-item").forEach((btn) => {
          btn.addEventListener("click", function () {
            if (
              this.textContent.includes("Novo") ||
              this.textContent.includes("Lan√ßamento")
            ) {
              setTimeout(() => {
                document.getElementById("desc").focus();
              }, 300);
            }
          });
        });

        atualizarTabela();
      }
      // ‚îÄ‚îÄ‚îÄ CONFIGURA√á√ïES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      async function salvarConfiguracoes() {
        if (!usuarioLogado) return;
        let saldo = document.getElementById("inputSaldoPrevio").value;
        const senha = document.getElementById("senhaConfirmacao").value;
        const msgE = document.getElementById("msgErroConfig");
        const msgS = document.getElementById("msgSucessoConfig");
        const btn = document.getElementById("btnSalvarConfig");
        msgE.classList.remove("show");
        msgS.classList.remove("show");

        if (!saldo) {
          msgE.innerText = "‚ùå Digite o novo saldo!";
          msgE.classList.add("show");
          return;
        }

        if (!senha) {
          msgE.innerText = "‚ùå Digite a senha!";
          msgE.classList.add("show");
          return;
        }

        // Verificar senha do usu√°rio logado
        if (senha !== usuarioLogado.senha) {
          msgE.innerText = "‚ùå Senha incorreta!";
          msgE.classList.add("show");
          document.getElementById("senhaConfirmacao").value = "";
          return;
        }

        // Formata saldo para n√∫mero
        saldo = saldo.replace(",", ".");
        const novoSaldo = parseFloat(saldo);

        if (isNaN(novoSaldo)) {
          msgE.innerText = "‚ùå Valor inv√°lido! Digite um n√∫mero.";
          msgE.classList.add("show");
          return;
        }

        if (!confirm(`Alterar saldo inicial para ${fmt(novoSaldo)}?`)) return;

        btn.innerText = "Salvando‚Ä¶";
        btn.disabled = true;

        try {
          const response = await fetch(API_URL, {
            method: "POST",
            body: JSON.stringify({
              action: "salvarConfig",
              usuario: usuarioLogado.usuario,
              salario: novoSaldo,
            }),
          });

          const data = await response.json();

          if (data && data.status === "ok") {
            document.getElementById("senhaConfirmacao").value = "";
            msgS.innerText = "‚úÖ Saldo atualizado com sucesso!";
            msgS.classList.add("show");

            // Atualiza a tabela para pegar o novo saldo
            await atualizarTabela();
          } else {
            msgE.innerText = "‚ùå " + (data?.erro || "Erro ao atualizar saldo");
            msgE.classList.add("show");
          }
        } catch (e) {
          console.error("Erro na API:", e);
          msgE.innerText = "‚ùå Erro de conex√£o com o servidor";
          msgE.classList.add("show");
        } finally {
          setTimeout(() => {
            btn.innerText = "Atualizar Saldo";
            btn.disabled = false;
            // Esconde mensagem de erro ap√≥s 3 segundos
            setTimeout(() => {
              msgE.classList.remove("show");
            }, 3000);
          }, 500);
        }
      }

      // ‚îÄ‚îÄ‚îÄ FILTRO PDF ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function popularFiltroMesAno() {
        const meses = [
          "Janeiro",
          "Fevereiro",
          "Mar√ßo",
          "Abril",
          "Maio",
          "Junho",
          "Julho",
          "Agosto",
          "Setembro",
          "Outubro",
          "Novembro",
          "Dezembro",
        ];
        const selM = document.getElementById("filtroMes");
        const selA = document.getElementById("filtroMesAno");
        const hoje = new Date();
        meses.forEach((m, i) => {
          const o = document.createElement("option");
          o.value = i;
          o.textContent = m;
          if (i === hoje.getMonth()) o.selected = true;
          selM.appendChild(o);
        });
        for (let a = hoje.getFullYear(); a >= 2020; a--) {
          const o = document.createElement("option");
          o.value = a;
          o.textContent = a;
          if (a === hoje.getFullYear()) o.selected = true;
          selA.appendChild(o);
        }
      }

      function atualizarFiltroPeriodo() {
        const tipo = document.getElementById("filtroTipo").value;
        document.getElementById("wrapMes").style.display =
          tipo === "mes" ? "contents" : "none";
        document.getElementById("wrapPeriodo").style.display =
          tipo === "periodo" ? "contents" : "none";
      }

      function obterPeriodoFiltro() {
        const tipo = document.getElementById("filtroTipo").value;
        if (tipo === "mes") {
          const m = parseInt(document.getElementById("filtroMes").value);
          const a = parseInt(document.getElementById("filtroMesAno").value);
          return { inicio: new Date(a, m, 1), fim: new Date(a, m + 1, 0) };
        }
        const i = document.getElementById("filtroPeriodoInicio").value;
        const f = document.getElementById("filtroPeriodoFim").value;
        if (!i || !f) return null;
        return {
          inicio: new Date(i + "T00:00:00"),
          fim: new Date(f + "T23:59:59"),
        };
      }

      // ‚îÄ‚îÄ‚îÄ GERAR PDF ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      async function gerarPDFLivroCaixa() {
        if (!usuarioLogado) return;
        const periodo = obterPeriodoFiltro();
        if (!periodo) return alert("Selecione um per√≠odo v√°lido!");

        let lista, saldoPrevio;
        try {
          const res = await fetch(
            `${API_URL}?senha=${usuarioLogado.senha}&usuario=${usuarioLogado.usuario}&action=ler`,
          );
          const data = await res.json();
          lista = data.lista || [];
          saldoPrevio = parseFloat(data.saldoPrevio) || 0;
        } catch (e) {
          console.error("Erro ao buscar dados:", e);
          alert("‚ùå Erro ao carregar dados para o PDF");
          return;
        }

        const filtrada = lista.filter((item) => {
          const d = parseDate(item[1]);
          if (!d || isNaN(d)) return false;
          const cmp = new Date(d.getFullYear(), d.getMonth(), d.getDate());
          return cmp >= periodo.inicio && cmp <= periodo.fim;
        });

        if (!filtrada.length)
          return alert("Nenhum registro no per√≠odo selecionado.");

        filtrada.sort(
          (a, b) => (parseDate(a[1]) || 0) - (parseDate(b[1]) || 0),
        );

        let tRec = 0,
          tPag = 0;
        filtrada.forEach((i) => {
          const recebido = parseFloat(String(i[3]).replace(",", ".")) || 0;
          const pago = parseFloat(String(i[4]).replace(",", ".")) || 0;
          tRec += recebido;
          tPag += pago;
        });
        const mov = tRec - tPag;

        const fmtMoeda = (v) => {
          const n = parseFloat(v);
          if (isNaN(n)) return "R$ 0,00";
          const abs = Math.abs(n),
            p = abs.toFixed(2).split(".");
          return (
            (n < 0 ? "-" : "") +
            "R$ " +
            p[0].replace(/\B(?=(\d{3})+(?!\d))/g, ".") +
            "," +
            p[1]
          );
        };

        const { jsPDF } = window.jspdf;
        const doc = new jsPDF("p", "mm", "a4");
        doc.setFont("helvetica");
        doc.setFontSize(18);
        doc.setFont("helvetica", "bold");
        doc.text(
          `LIVRO DE CAIXA - ${usuarioLogado.nome.toUpperCase()}`,
          105,
          20,
          { align: "center" },
        );
        doc.setFontSize(11);
        doc.setFont("helvetica", "normal");
        const fD = (d) =>
          d
            .toLocaleDateString("pt-BR", {
              day: "2-digit",
              month: "short",
              year: "numeric",
            })
            .replace(/ de /g, " ");
        doc.text(
          `Per√≠odo: ${fD(periodo.inicio)} at√© ${fD(periodo.fim)}`,
          105,
          28,
          { align: "center" },
        );

        const body = [["", "SALDO PR√âVIO", "", "", fmtMoeda(saldoPrevio)]];
        let acum = saldoPrevio;
        filtrada.forEach((item) => {
          const recebido = parseFloat(String(item[3]).replace(",", ".")) || 0;
          const pago = parseFloat(String(item[4]).replace(",", ".")) || 0;
          acum += recebido - pago;
          const d = parseDate(item[1]);
          const dStr = d ? fD(d) : String(item[1]);
          body.push([
            dStr,
            item[2] || "-",
            recebido > 0 ? fmtMoeda(recebido).replace("R$ ", "") : "",
            pago > 0 ? fmtMoeda(pago).replace("R$ ", "") : "",
            fmtMoeda(acum),
          ]);
        });
        body.push(["", "", "", "", ""]);
        body.push([
          "",
          "TOTAL RECEBIDO",
          fmtMoeda(tRec).replace("R$ ", ""),
          "",
          "",
        ]);
        body.push([
          "",
          "TOTAL PAGO",
          "",
          fmtMoeda(tPag).replace("R$ ", ""),
          "",
        ]);
        body.push(["", "SALDO MOVIMENTA√á√ÉO", "", "", fmtMoeda(mov)]);
        body.push(["", "SALDO PR√âVIO", "", "", fmtMoeda(saldoPrevio)]);
        body.push([
          "",
          "SALDO FINAL EM CAIXA",
          "",
          "",
          fmtMoeda(saldoPrevio + mov),
        ]);

        doc.autoTable({
          startY: 35,
          head: [["DATA", "DESCRI√á√ÉO", "RECEBIDO", "PAGO", "SALDO"]],
          body,
          theme: "grid",
          headStyles: {
            fillColor: [227, 29, 26],
            textColor: [255, 255, 255],
            fontStyle: "bold",
            halign: "center",
            fontSize: 10,
          },
          bodyStyles: { fontSize: 9, cellPadding: 3 },
          columnStyles: {
            0: { halign: "center", cellWidth: 25 },
            1: { halign: "left", cellWidth: 70 },
            2: { halign: "right", cellWidth: 28 },
            3: { halign: "right", cellWidth: 28 },
            4: { halign: "right", cellWidth: 32 },
          },
          didParseCell(data) {
            if (data.section === "body" && data.row.index === 0) {
              data.cell.styles.fillColor = [240, 240, 240];
              data.cell.styles.fontStyle = "bold";
            }
            if (data.section === "body" && data.row.index >= body.length - 5) {
              data.cell.styles.fillColor = [255, 255, 0];
              data.cell.styles.fontStyle = "bold";
            }
          },
        });

        doc.setFontSize(8);
        doc.setFont("helvetica", "italic");
        doc.text(
          `Gerado em: ${new Date().toLocaleString("pt-BR")}`,
          14,
          doc.internal.pageSize.height - 10,
        );

        const pad = (n) => String(n).padStart(2, "0");
        const nome = `Livro_Caixa_${usuarioLogado.nome.replace(/\s/g, "_")}_${periodo.inicio.getFullYear()}${pad(periodo.inicio.getMonth() + 1)}${pad(periodo.inicio.getDate())}_a_${periodo.fim.getFullYear()}${pad(periodo.fim.getMonth() + 1)}${pad(periodo.fim.getDate())}.pdf`;
        doc.save(nome);
        alert(`‚úÖ PDF gerado! (${filtrada.length} registros)`);
      }
    </script>
  </body>
</html>
